### 组件通信

#### 父子组件间传值：

**通过props**：

> 父组件将自己的状态传递给子组件，子组件当做属性来接收，当父组件更改自己状态的时候，子组件接收到的属性就会发生改变(重新渲染)

```jsx
// 父组件
import React, { Component } from 'react'
import Child from './pages/Child'

class App extends Component {
  state = {
    num: 1
  }
  setNum = (n = 1) => this.setState(state => ({ num: state.num + n }))

  render() {
    let { num } = this.state
    return (
      <div>
        <Child num={num} setNum={this.setNum} />
      </div>
    )
  }
}

export default App
```

```jsx
// 子组件
import React, { Component } from 'react'

class Child extends Component {
  render() {
    let { num, setNum } = this.props
    return (
      <div>
        <h3>Child组件 -- {num}</h3>
        {/* 子去修改父传过来的数据,props它是单向数据流，子不能直接去修改 */}
        <button onClick={() => setNum(2)}>+++++</button>
      </div>
    )
  }
}

export default Child
```

**通过ref**：

> 父组件利用ref对子组件做标记，通过调用子组件的方法以更改子组件的状态,也可以调用子组件的方法(说明：ref获取当前组件对象，只针对的是使用类创建的组件才可以用此方案，类有实例，而函数没有实例,默认只针对于类组件)

```jsx
// 父组件
import React, { Component, createRef } from 'react'
import Child from './pages/Child'

class App extends Component {
  state = {
    title: '',
    msg: Date.now()
  }
  childRef = createRef()
  render() {
    return (
      <div>
        <h3>{this.state.title}</h3>
        <Child ref={this.childRef} />
        <button
          onClick={() => {
            // 子中的数据在父中使用
            this.setState({ title: this.childRef.current.state.title })
            // 父中的数据传给子
            this.childRef.current.setTitle(this.state.msg)
            // 当然也可能直接修改子中的数据，但是不推荐这样的hack操作
            this.childRef.current.setState({ title: this.state.msg })
          }}
        >
          父组件中修改子组件中的数据
        </button>
      </div>
    )
  }
}

export default App
```

```jsx
// 子组件
import React, { Component } from 'react'

class Child extends Component {
  state = {
    title: '我是子组件'
  }
  setTitle = title => this.setState({ title })
  render() {
    return (
      <div> <h3>{this.state.title}</h3> </div>
    )
  }
}

export default Child
```

#### 兄弟组件间传值：

**状态提升：**

> 此方案用来解决兄弟组件间的传值问题，就是把共用的状态信息提升到父组件状态中。

```jsx
import React, { Component } from 'react'

class Child1 extends Component {
  render() {
    let { setMsg } = this.props
    return (
      <div>
        <input type="text" onChange={e => setMsg(e.target.value)} />
      </div>
    )
  }
}

class Child2 extends Component {
  render() {
    let { msg } = this.props
    return (
      <div>
        <h3>{msg}</h3>
      </div>
    )
  }
}

class App extends Component {
  state = {
    msg: '',
    setMsg: msg => this.setState({ msg })
  }

  render() {
    let { msg, setMsg } = this.state
    return (
      <div>
        <h1>{msg}</h1>
        <Child1 {...this.state} />
        <Child2 {...this.state} />
      </div>
    )
  }
}

export default App
```

#### 跨组件通信：

> Context 提供了一个无需为每层组件手动添加 props，就能在组件树间进行数据传递的方法。Context 设计目的是为了共享那些对于一个组件树而言是“全局”的数据。
>
> 在React的Context中，数据我们可当成商品，发布数据的组件会用provider身份（卖方），接收数据的组件使用consumer身份（卖方）

- 创建Context对象：

1. context一个项目中可以有N个,但是一般情况下我们使用它，都是把它放在App组件中，一个项目一个
2. context实现在跨组件通信，一般用于自定义组件所用

```jsx
/src/context/appContext.js

import { createContext } from 'react'

const ctx = createContext()
const { Provider, Consumer } = ctx
export {
  ctx as default,
  Provider,
  Consumer
}
```

- 发布消息：

```jsx
import React, { Component } from 'react'
import { Provider } from './context/appContext'
import Child from './pages/Child'

class App extends Component {
  state = {
    name: '张三',
    setName: name => this.setState({ name })
  }
  render() {
    return (
      <div>
        {/* value属性就是生产的数据源 */}
        <Provider value={this.state}>
          <Child />
        </Provider>
      </div>
    )
  }
}

export default App
```

- 组件消费：

> 通过组件消费
>
> 需要在Consumer在写入一个函数，这个参数会被回调并接收Provider提供的数据

```jsx
import React, { Component } from "react";
import ctx, { Consumer } from "../../context/appContext";

class Child extends Component {
  render() {
    return (
      <div>
        <Consumer>
          {(state) => (
            <div>
              <h3>{state.name}</h3>
              <button
                onClick={() => {
                  state.setName(Date.now());
                }}
              >
                ++++
              </button>
            </div>
          )}
        </Consumer>
      </div>
    );
  }
}

export default Child;
```

> 通过绑定静成属性来消费
>
> 需要在组件类中定义一个静态属性contextType，把其赋值为ctx，定义好后，就可以通过成员属性 this.context来获取数据

```jsx
import React, { Component } from 'react'
import ctx, { Consumer } from '../../context/appContext'

class Child extends Component {
  static contextType = ctx

  render() {
    return (
      <div>
        <h3>{this.context.name}</h3>
        <button onClick={() => {
            this.context.setName(Date.now())
          }}>++++
        </button>
      </div>
    )
  }
}

export default Child
```

