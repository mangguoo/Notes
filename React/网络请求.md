### 网络请求

#### 静态文件服务器：

> 在react脚手架中内置了express服务器，它的public文件夹其实就是静态文件目录app.use(express.static())，因此可以使用网络请求直接请求该目录内的文件，比如mock数据：

```js
/public/mock/users.json

{
  "id": 1,
  "name": "张三"
}
```

```jsx
import React, { Component } from 'react'
import { get } from './utils/http'
import Loading from './components/Loading'

class App extends Component {
  state = {
    users: null
  }
  async componentDidMount() {
    let users = await get('/mock/users.json')
    this.setState({ users })
  }
  render() {
    return (
      <div>
        {
          // 这里必须判断一下，如果直接渲染state.users.name会报错，因为users一开始是null，它是在网络请求完成后通过重新渲染才会有的
          this.state.users ? <h3>{this.state.users.name}</h3> : <Loading />
        }
      </div>
    )
  }
}

export default App
```

#### 解决跨域：

> 1. 在src目录下创建一个setupProxy.js文件，react脚手架会读取这个文件，把根据它设置代理
> 2. 安装代理间件模块：npm install -D http-proxy-middleware

```js
/mock/user.js

module.exports = app => {
  app.get('/api/users', (req, res) => {
    res.send([
      { id: 1, name: '张三' },
      { id: 2, name: '英子' },
    ])
  })
}
```

```js
/src/setupProxy.js

const { createProxyMiddleware: proxy } = require('http-proxy-middleware')

const userMockFn = require('../mock/user')

module.exports = app => {
  userMockFn(app) // mock接口
    
  app.use('/api', proxy({
    target: 'https://api.iynn.cn/film',
    changeOrigin: true,
    pathRewrite: {
      "^/api": ""
    }
  }))
}
```

